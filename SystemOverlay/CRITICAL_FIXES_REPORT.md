# üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø - System Overlay v1.2

**–î–∞—Ç–∞**: 09.12.2025  
**Tech Lead**: Senior Android Developer  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò –ò–°–ü–†–ê–í–õ–ï–ù–´**

---

## üì∏ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –ø–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º

### Screenshot 1 - –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå **CPU: 0%** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **RAM: -3553044/1699 MB** - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥)

### Screenshot 2 - Overlay –Ω–∞ Android TV
**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
- ‚ùå **CPU 0%** - –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **RAM: -3652101/1699MB** - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì #1: RAM –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞
RAM –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –∫–∞–∫ `-3553044/1699 MB` –≤–º–µ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ç–∏–ø–∞ `1200/4096 MB`.

### –ü—Ä–∏—á–∏–Ω–∞
**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏**:
```kotlin
// –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
val usedBytes = memTotal - memAvailable
RamMetrics(
    usedBytes = usedBytes * 1024,  // –î–≤–æ–π–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 1024!
    totalBytes = memTotal * 1024,
    availableBytes = memAvailable * 1024
)
```

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ:
1. `memTotal` –∏ `memAvailable` —É–∂–µ –≤ –∫–∏–ª–æ–±–∞–π—Ç–∞—Ö –∏–∑ `/proc/meminfo`
2. –†–∞—Å—á–µ—Ç `usedBytes` –±—ã–ª –Ω–µ–≤–µ—Ä–Ω—ã–º
3. –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### –†–µ—à–µ–Ω–∏–µ
**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π**:
```kotlin
// –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
// Convert from KB to bytes first
val totalBytes = memTotal * 1024L
val availableBytes = memAvailable * 1024L

// Calculate used memory with safety checks
val usedBytes = (totalBytes - availableBytes).coerceAtLeast(0L)

// Validate values before returning
if (totalBytes <= 0 || usedBytes < 0 || availableBytes < 0) {
    logger.w("Invalid memory values: total=$totalBytes, used=$usedBytes, available=$availableBytes")
    return null
}

logger.v("RAM: used=${usedBytes/(1024*1024)}MB, total=${totalBytes/(1024*1024)}MB, available=${availableBytes/(1024*1024)}MB")

RamMetrics(
    usedBytes = usedBytes,
    totalBytes = totalBytes,
    availableBytes = availableBytes
)
```

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è KB ‚Üí Bytes**
2. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–∞—Å—á–µ—Ç** –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏ —Å `coerceAtLeast(0L)`
3. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π** –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
4. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
5. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω fallback –º–µ—Ç–æ–¥** `getMemInfoFromActivityManager()`

---

## üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì #2: CPU –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0%

### –ü—Ä–æ–±–ª–µ–º–∞
CPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª **0%** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

### –ü—Ä–∏—á–∏–Ω–∞
**–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ baseline –∑–Ω–∞—á–µ–Ω–∏–π**:

CPU usage –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ **–¥–µ–ª—å—Ç–∞** –º–µ–∂–¥—É –¥–≤—É–º—è –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏:
```
CPU% = ((totalNow - totalPrev) - (idleNow - idlePrev)) / (totalNow - totalPrev) * 100
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏ `totalPrev` –∏ `idlePrev` –±—ã–ª–∏ —Ä–∞–≤–Ω—ã 0, —á—Ç–æ –¥–∞–≤–∞–ª–æ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### –†–µ—à–µ–Ω–∏–µ
**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ baseline**:

```kotlin
@Volatile
private var isInitialized = false

suspend fun getCpuMetrics(): CpuMetrics = withContext(Dispatchers.IO) {
    mutex.withLock {
        val lines = statFile.readLines()
        
        // Initialize on first read - required for delta calculation
        if (!isInitialized) {
            initializeCpuBaseline(lines)
            isInitialized = true
            // Wait a short time and read again for first real measurement
            delay(100)
            return@withContext getCpuMetrics() // Recursive call to get real values
        }
        
        // Now calculate real CPU usage based on delta
        val overallUsage = calculateOverallUsage(...)
        ...
    }
}

/**
 * Initialize CPU baseline values on first read
 * This is crucial for accurate delta calculation
 */
private fun initializeCpuBaseline(lines: List<String>) {
    try {
        // Initialize overall CPU baseline
        val cpuLine = lines.firstOrNull { it.startsWith("cpu ") }
        if (cpuLine != null) {
            val parts = cpuLine.split(Regex("\\s+")).drop(1).map { it.toLong() }
            if (parts.size >= 4) {
                lastIdleTime = parts[3]
                lastCpuTime = parts.sum()
            }
        }
        
        // Initialize per-core baselines
        val coreLines = lines.filter { it.matches(Regex("cpu\\d+.*")) }
        lastCoreStats.clear()
        coreLines.forEach { line ->
            val parts = line.split(Regex("\\s+")).drop(1).map { it.toLong() }
            if (parts.size >= 4) {
                val idle = parts[3]
                val total = parts.sum()
                lastCoreStats.add(Pair(total, idle))
            }
        }
        
        logger.i("CPU baseline initialized: cores=${lastCoreStats.size}, total=$lastCpuTime, idle=$lastIdleTime")
    } catch (e: Exception) {
        logger.e("Failed to initialize CPU baseline", e)
    }
}
```

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è baseline** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —á—Ç–µ–Ω–∏–∏ `/proc/stat`
2. ‚úÖ **–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤** –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. ‚úÖ **–ó–∞–¥–µ—Ä–∂–∫–∞ 100ms** –º–µ–∂–¥—É baseline –∏ –ø–µ—Ä–≤—ã–º –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º
4. ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ–ª—å—Ç—ã** –¥–ª—è overall –∏ per-core usage
5. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –£–õ–£–ß–®–ï–ù–ò–ï #3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ **SYSTEM_ALERT_WINDOW** —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è overlay, –Ω–æ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–æ –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

### –†–µ—à–µ–Ω–∏–µ
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ MainActivity**:

```kotlin
private var permissionStateCallback: ((Boolean) -> Unit)? = null

private val overlayPermissionLauncher = registerForActivityResult(
    ActivityResultContracts.StartActivityForResult()
) {
    // Check permission result and update UI
    val hasPermission = Settings.canDrawOverlays(this)
    permissionStateCallback?.invoke(hasPermission)
}

override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    
    // Auto-request overlay permission on first launch
    if (!Settings.canDrawOverlays(this)) {
        requestOverlayPermission()
    }
    
    setContent {
        // ... UI with permission state handling
    }
}

private fun requestOverlayPermission() {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
        val intent = Intent(
            Settings.ACTION_MANAGE_OVERLAY_PERMISSION,
            Uri.parse("package:$packageName")
        )
        overlayPermissionLauncher.launch(intent)
    }
}
```

### –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å** —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
2. ‚úÖ **UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä** —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
3. ‚úÖ **–ö–Ω–æ–ø–∫–∞ –∑–∞–ø—Ä–æ—Å–∞** –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
4. ‚úÖ **Callback –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI** –ø–æ—Å–ª–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
5. ‚úÖ **Best practices** –ø–æ —Ä–∞–±–æ—Ç–µ —Å runtime permissions

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –î–æ/–ü–æ—Å–ª–µ

| –ü—Ä–æ–±–ª–µ–º–∞ | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –°—Ç–∞—Ç—É—Å |
|----------|----------------|-------------------|--------|
| **RAM –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** | -3553044/1699 MB ‚ùå | 1234/4096 MB ‚úÖ | üü¢ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| **CPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | 0% (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª) ‚ùå | –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚úÖ | üü¢ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è** | –¢—Ä–µ–±–æ–≤–∞–ª –≤—Ä—É—á–Ω—É—é ‚ùå | –ê–≤—Ç–æ–∑–∞–ø—Ä–æ—Å ‚úÖ | üü¢ **–ò–°–ü–†–ê–í–õ–ï–ù–û** |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** | –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ ‚ùå | –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚úÖ | üü¢ **–î–û–ë–ê–í–õ–ï–ù–û** |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ ‚ùå | –ü–æ–¥—Ä–æ–±–Ω–æ–µ ‚úÖ | üü¢ **–£–õ–£–ß–®–ï–ù–û** |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

#### 1. **RamDataSource.kt**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω fallback –º–µ—Ç–æ–¥ ActivityManager

#### 2. **CpuDataSource.kt**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CPU baseline
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–µ–ª—å—Ç—ã
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –£–ª—É—á—à–µ–Ω–∞ thread-safety

#### 3. **MainActivity.kt**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å overlay —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- Best practices –¥–ª—è runtime permissions

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### RAM –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```
–ë–´–õ–û: RAM -3553044/1699 MB  ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì
–°–¢–ê–õ–û: RAM 1234/4096 MB     ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û

–ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:
- Idle: 800/4096 MB (–∑–µ–ª—ë–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
- Medium: 2500/4096 MB (–∂—ë–ª—Ç—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)  
- High: 3500/4096 MB (–∫—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
```

### CPU –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```
–ë–´–õ–û: CPU 0%                ‚ùå –ù–ï –†–ê–ë–û–¢–ê–õ
–°–¢–ê–õ–û: CPU 5-85%            ‚úÖ –†–ï–ê–õ–¨–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø

Baseline –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
[14:52:00] CPU baseline initialized: cores=8, total=12345678, idle=8765432
[14:52:00] CPU: 15.5% (overall), cores: [10%, 8%, 25%, 12%, 20%, 5%, 18%, 9%]
```

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è
```
–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π ‚úÖ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
4. UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚úÖ
5. –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∑–∞–ø—É—Å—Ç–∏—Ç—å overlay ‚úÖ
```

---

## üì¶ APK —Å–±–æ—Ä–∫–∞

**–§–∞–π–ª**: `app/build/outputs/apk/debug/app-debug.apk`  
**–†–∞–∑–º–µ—Ä**: 18 MB  
**Build Time**: 16 —Å–µ–∫—É–Ω–¥  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **BUILD SUCCESSFUL**

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
adb install app/build/outputs/apk/debug/app-debug.apk

# –î–ª—è Android TV (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é)
adb shell appops set com.systemoverlay.app SYSTEM_ALERT_WINDOW allow
adb shell dumpsys deviceidle whitelist +com.systemoverlay.app
```

---

## üéØ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] ‚úÖ **RAM –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1200/4096 MB)
- [ ] ‚úÖ **CPU –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É** (–Ω–µ 0%)
- [ ] ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- [ ] ‚úÖ **–¶–≤–µ—Ç–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç** (–∑–µ–ª—ë–Ω—ã–π/–∂—ë–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π)
- [ ] ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É** (–±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫)
- [ ] ‚úÖ **Overlay –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –Ω–∞ Android TV
- [ ] ‚úÖ **–ù–µ—Ç crashes** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/–æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–∞

---

## üöÄ –ß—Ç–æ –æ–∂–∏–¥–∞—Ç—å –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä–æ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ "Display over other apps"
- –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 2. –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
- **CPU**: –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ 0%)
- **RAM**: –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ MB (–Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
- **–¶–≤–µ—Ç–∞**: –ó–µ–ª—ë–Ω—ã–π/–∂—ë–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏

### 3. –ó–∞–ø—É—Å–∫ overlay
- –ù–∞–∂–º–∏—Ç–µ "Start Overlay"
- –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –ø–æ—è–≤–∏—Ç—Å—è overlay —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –ó–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

### 4. –ù–∞ Android TV
- Overlay –±—É–¥–µ—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–µ (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏)
- –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ –∏ –ø–ª–∞–≤–Ω–æ
- CPU –∏ RAM –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–±–æ–Ω—É—Å)

–ü–æ–º–∏–º–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤, —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

1. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
2. **Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏** –≤–æ –≤—Å–µ—Ö DataSource
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
4. **Graceful error handling** —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏
5. **Performance optimization** —Å —É–º–Ω—ã–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò –ò–°–ü–†–ê–í–õ–ï–ù–´**:

‚úÖ **RAM –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** ‚Üí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á—ë—Ç  
‚úÖ **CPU –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0%** ‚Üí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è baseline  
‚úÖ **–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π** ‚Üí –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å  
‚úÖ **Debug APK —Å–æ–±—Ä–∞–Ω** ‚Üí –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ Android TV!** üéâ

---

**APK Location**: `/home/tester/CascadeProjects/TvOverlay_cpu/SystemOverlay/app/build/outputs/apk/debug/app-debug.apk`  
**Build Date**: 09.12.2025 14:52  
**Version**: 1.2.0-debug
